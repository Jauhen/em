<!DOCTYPE HTML>

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>&lt;epam:memes&gt;</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script type="text/javascript" src="js/lib/underscore.js"></script>
    <script type="text/javascript" src="js/lib/jquery.js"></script>
    <script type="text/javascript" src="js/lib/backbone.js"></script>
    <link rel="chrome-webstore-item"
          href="https://chrome.google.com/webstore/detail/jgmpoflmemllolbnmidoclcpbpoabcib">
    <script type="text/javascript">
      var PLUGIN_URL = 'https://chrome.google.com/webstore/detail/jgmpoflmemllolbnmidoclcpbpoabcib';

      $.browser.chrome = /chrome/.test(navigator.userAgent.toLowerCase());

      function init() {
    	setTimeout(function() {
          // Check if plugin is installed by searching for element with id "epam-memegen-extension-is-installed".
          // If not found - show button.
      	  if ($('#epam-memegen-extension-is-installed').length) {
            console.log("EPAM memegen plugin is installed");
      	  } else {
      		$('#epam-memegen-install-button').get(0).style.removeProperty("display");
      	  }}, 1000);
      }

      function installPlugin() {
        if ($.browser.chrome) {
          console.log("This is Chrome, proceeding with inline-install");
          installPluginChrome();
        } else {
          console.log("This is not Chrome, simply redirecting to Chrome Store's page of the plugin");
          window.location = PLUGIN_URL;
        }
      }

      function installPluginChrome() {
        // This works only in Chrome
        chrome.webstore.install(
          PLUGIN_URL,
          function() {
            $('#epam-memegen-install-button').hide();
          },
          function(err) {
            // Show error message to user (may be this should be turned off)
            alert(err);
          }
        )
      }
    </script>
  </head>

  <body onload="init();">

    <div id="msg" class="msg" style="display: none;"></div>

    <h1 id="header">&lt;epam:memegen&gt;</h1>

    <div id="epam-memegen-install-button" style="display:none;" class="plugin-button">
      <img src="chrome-icon.png" class="plugin-img"/>
      <span onclick="installPlugin();" class="plugin-link">
          Don't miss a single meme - install Chrome Plugin
      </span>
    </div>

    <div id="sidePane" class="isLoggedIn_###IS_AUTHENTICATED###">
      <button id="showCreateDialog" onclick="$('.upload').toggle()">
        Create
      </button>
      <br/>
      <br/>
      <button id="delete" style="display: none;">
        Delete
      </button>
    </div>

    <div id="contentPane">
      <div>
        <div class="upload" style="display: none;">
          <div class="imageWithUpload">
            <div id="preview" class="preview"></div>
            <div id="uploadHelperText" class="uploadHelperText">
                <a id="uploadLink" href="#">Upload</a> new image,<br/>
                or click on any meme.
            </div>
            <input id="uploadFile" class="uploadFile" type="file">
            <input id="uploadUrl" type="hidden" value="###UPLOAD_URL###">
            <br/>
          </div>
          <div class="form">
            <textarea id="top"></textarea>
            <br/>
            <textarea id="center"></textarea>
            <br/>
            <textarea id="bottom"></textarea>
            <br/>
            <input type="hidden" name="blobKey"/>
            <button id="submit">Submit</button>
          </div>
          <div class="clear"></div>
        </div>
      </div>

      <div class="pleaseLoginMessage isLoggedIn_###IS_AUTHENTICATED###">
        <a href="###LOGIN_URL###">Please login</a>.
        Only accounts <b>@epam.com</b> are allowed###WRONG_EMAIL_MSG###.
        <br/>
        <br/>
        Most people already have an account at <a href="http://google.com/a/epam.com">google.com/a/epam.com</a>,
        but if you don't, please ask <b>helpdesk@epam.com</b>.
        <br/>
        Sorry for inconvenience, we're working on a more convenient authentication, using PMC API.
      </div>

      <div id="memesList"></div>
    </div>

    <script>
    var MEMES_JSON = ###MEMES_JSON###;
    </script>
    <script type="text/javascript" src="js/model/vote.js"></script>
    <script type="text/javascript" src="js/model/meme.js"></script>
    <script type="text/javascript" src="js/model/app.js"></script>
    <script type="text/javascript" src="js/create.js"></script>
    <script type="text/javascript" src="js/msg.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36410794-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    </body>
</html>
